<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>~LOJINHA~</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Italiana&family=Montserrat:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">
    
    <style>

        header {
            
            text-align: center;
            top: 0;
            left: 0;
            width: 100%;
            min-height: 325px;
            background-image: url("https://nordware.io/blog/wp-content/uploads/2022/02/8-960x540.png");
            background-size: 100%;
            background-position: 0% 25%;
            align-items: center;
        
        }

        body {

            font-family: 'Montserrat', serif;

        }

        header h1 {

            font-size: 150px;
            color:white;
            font-family: 'Italiana', serif;
            margin-bottom: -10px;

        }

        alegoria {

            color:whitesmoke;

        }

        tbody {

            font-weight: 500;

        }

        .modal-body .align-items-center{

            margin-top:10px;

        }

        .form-label {

            margin-right: 5px;

        }


        .btn-logout {
  
            position: fixed;
            bottom: 10px; 
            right: 10px; 
            border-radius: 75px 75px;
            margin: 10px;
        
        }

    </style>

</head>

    <a href="/logout" class=" btn btn-danger float-end btn-logout" style="margin: 10px 30px; border-radius: 75px 75px;">Logout <i class="bi bi-door-open-fill" style="margin-left:3px"> </i></a>


    <header>
        
        <h1> ~LOJINHA~</h1>

        <div id="container">

            <div class="m-3 d-flex justify-content-center">

                <input type="text" class="form-control" oninput="buscar_nome()" id="search" style = "width: 40%; border-radius: 75px 75px;">
                
                <button class="btn btn-primary" onclick="limpar_campo(); get_dados()" style="border-radius: 50%; margin: 0 5px"><i class=" bi-x-lg"></i></button>

                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal"
                style="border-radius: 50%;"><i class="bi bi-plus-lg"></i></button>

            </div>

        </div>

        <input class="btn btn-primary btn-sm" type="button" value="roupas" onclick="buscar_categoria('roupas')" style = "border-radius: 75px 75px; margin: 0 3px;">
        <alegoria>•</alegoria>
        <input class="btn btn-primary btn-sm" type="button" value="comida" onclick="buscar_categoria('comida')" style = "border-radius: 75px 75px; margin: 0 3px;">
        <alegoria>•</alegoria>
        <input class="btn btn-primary btn-sm" type="button" value="artigos esportivos" onclick="buscar_categoria('artigos esportivos')" style = "border-radius: 75px 75px; margin: 0 3px;">
        <alegoria>•</alegoria>
        <input class="btn btn-primary btn-sm" type="button" value="beleza" onclick="buscar_categoria('beleza')" style = "border-radius: 75px 75px; margin: 0 3px;">

    </header>


    <div>

        <table class="table table-striped table-hoover" style = "width:96%; margin: 20px auto 0px;">
            
            <thead>
                
                <tr>

                    <th style = "background-color:#0d6efd; color:white; font-weight: 500; text-align: center; border-top-left-radius: 25px;"></th>
                    <th style = "background-color:#0d6efd; color:white; font-weight: 500; text-align: center;">Categoria</th>
                    <th style = "background-color:#0d6efd; color:white; font-weight: 500; text-align: center;">Nome</th>
                    <th style = "background-color:#0d6efd; color:white; font-weight: 500; text-align: center;">Preço (R$)</th>
                    <th style = "background-color:#0d6efd; color:white; font-weight: 500; text-align: center;">Expandir</th>
                    <th style = "background-color:#0d6efd; color:white; font-weight: 500; text-align: center;">Editar</th>
                    <th style = "background-color:#0d6efd; color:white; font-weight: 500; text-align: center; border-top-right-radius: 25px;">Excluir</th>
                
                </tr>
          
            </thead>

            <tbody id="dados_loja">

            </tbody>

        </table>

    </div>

    <!-- Modal Cadastrar-->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        
        <div class="modal-dialog">
            
            <div class="modal-content">
                
                <div class="modal-header">
                    
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Cadastrar produto</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                
                </div>
            
                <div class="modal-body">
                    
                    <div class="align-items-center" style = "margin-top:0px">
                        
                        <label for="input_categoria" class="form-label">Categoria:</label>
                        <select id="input_categoria" class="form-select">
                            
                            <option selected>Selecione a categoria...</option>
                            <option value="Roupas">roupas</option>
                            <option value="Comida">comida</option>
                            <option value="Artigos esportivos">artigos esportivos</option>
                            <option value="Beleza">beleza</option>
                        
                        </select>
          
                    </div>
          
                    <div class="align-items-center">
            
                        <label for="input_nome" class="form-label">Nome:</label>
                        <input type="text" id="input_nome" class="form-control">
          
                    </div>

                    <div class="align-items-center">

                        <label for="input_preco" class="form-label">Preço:</label>
                        
                        <div class="d-flex input-group">

                            <span class="input-group-text">R$</span>
                            <span class="input-group-text">0.00</span>
                            <input type="text" id="input_preco" class="form-control" aria-label="preco_reais">
                        
                    </div>  

                    </div>

                    <div class="align-items-center">
            
                        <label for="input_descricao" class="form-label">Descrição:</label>
                        <textarea class="form-control" id="input_descricao" rows="3"></textarea>
                        
                    </div>

                    <div class="align-items-center">
                        
                        <label for="input_imagem" class="form-label">Imagem:</label>

                        <div class="d-flex input-group">

                            <span class="input-group-text" style = "padding-right: 40px;">Inserir url...</span>
                            <input class="form-control" type="url" id="input_imagem" value="https://" style="color:grey">
                        
                        </div>

                    </div>
        
                </div>
        
                <div class="modal-footer">
          
                    <button type="button" class="btn btn-primary" onclick="cadastrar()">Salvar</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        
                </div>
      
            </div>
    
        </div>
  
    </div>

    <!-- Modal Remover Dados-->
    <div class="modal fade" id="modalRemover" tabindex="-1" aria-labelledby="modalRemover" aria-hidden="true">
    
        <div class="modal-dialog">
      
            <div class="modal-content">
        
                <div class="modal-body">
          
                    <div class="d-flex align-items-center justify-content-center">
            
                        <i class="bi bi-x-octagon-fill text-danger" style="font-size: 5rem;"></i>
          
                    </div>
          
                    <div class="d-flex align-items-center justify-content-center">
            
                        <p class="h4">Deseja realmente remover esse item?</p>
          
                    </div>
        
                </div>
        
                <div class="modal-footer">
          
                    <button type="button" class="btn btn-primary" id="remover">Remover</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>

                </div>
      
            </div>
    
        </div>
  
    </div>

    <!-- Modal Editar-->
    <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
        
        <div class="modal-dialog">
            
            <div class="modal-content">
                
                <div class="modal-header">
                    
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Editar</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                
                </div>
            
                <div class="modal-body">
                    
                    <div class="align-items-center" style = "margin-top:0px">
                        
                        <label for="edit_categoria" class="form-label">Categoria:</label>
                        <select id="edit_categoria" class="form-select">
                            
                            <option selected>Selecione a categoria...</option>
                            <option value="Roupas">roupas</option>
                            <option value="Comida">comida</option>
                            <option value="Artigos esportivos">artigos esportivos</option>
                            <option value="Beleza">beleza</option>
                        
                        </select>
          
                    </div>
          
                    <div class="align-items-center">
            
                        <label for="edit_nome" class="form-label">Nome:</label>
                        <input type="text" id="edit_nome" class="form-control">
          
                    </div>

                    <div class="align-items-center">

                        <label for="edit_preco" class="form-label">Preço:</label>
                        
                        <div class="d-flex input-group">

                            <span class="input-group-text">R$</span>
                            <span class="input-group-text">0.00</span>
                            <input type="text" id="edit_preco" class="form-control" aria-label="preco_reais">
                        
                    </div>  

                    </div>

                    <div class="align-items-center">
            
                        <label for="edit_descricao" class="form-label">Descrição:</label>
                        <textarea class="form-control" id="edit_descricao" rows="3"></textarea>
                        
                    </div>

                    <div class="align-items-center">
                        
                        <label for="edit_imagem" class="form-label">Imagem:</label>

                        <div class="d-flex input-group">

                            <span class="input-group-text" style = "padding-right: 40px;">Inserir url...</span>
                            <input class="form-control" type="url" id="edit_imagem" value="https://" style="color:grey">
                        
                        </div>

                    </div>
        
                </div>
        
                <div class="modal-footer">
          
                    <button type="button" class="btn btn-primary" id="editar">Editar</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        
                </div>
      
            </div>
    
        </div>
  
    </div>

    <!-- Modal Expandir Dados-->
    <div class="modal fade" id="showModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
        
        <div class="modal-dialog">
          
            <div class="modal-content">

                <card id="card">

                </card>
            
            </div>

        </div>
          
    </div>

    <script>

        baseUrl = 'http://localhost:3000';
        get_dados();

        async function exibir_dados(produtos) {
        
            const tbody = document.querySelector("#dados_loja");

            let linhas = "";
            
            produtos.forEach((dado, index) => {
                
                linhas += `<tr>
                    
                    <td><i class="d-flex justify-content-center">${index + 1}.</i></td>
                    <td>${dado.categoria}</td>
                    <td>${dado.nome}</td>
                    <td>${dado.preco}</td>
                    <td><i class="bi bi-arrows-fullscreen d-flex justify-content-center" style="cursor: pointer" onclick="expandir_dados(${dado.id})"></i></td>
                    <td><i class="bi bi-pencil-square d-flex justify-content-center" style="cursor: pointer" onclick="editar_dados(${dado.id})"></i></td>
                    <td><i class="bi bi-trash d-flex justify-content-center" style="cursor: pointer" onclick="remover_dados(${dado.id})"></i><div></td>
                    </tr>`;
            
            });

            if (linhas == "") {
                
                linhas = `
                
                <tr>
                    <td colspan="7" style="text-align:center">Não há dados cadastrados</td>
                </tr>
                `;

            }

            tbody.innerHTML = linhas;

        }

        async function get_dados() {
        
            try {

                const response = await fetch(baseUrl + '/produtos');

                if (response.ok) {
            
                    const data = await response.json();
                    exibir_dados(data);
        
                } else {
            
                    throw new Error('Erro ao obter dados');
        
                }
    
            } catch (error) {
        
                alert("Ocorreu um erro");
                console.log(error);
    
            }

        }

        async function cadastrar() {
            
            const input_categoria = document.querySelector("#input_categoria")
            const input_nome = document.querySelector("#input_nome");
            const input_preco = document.querySelector("#input_preco");
            const input_descricao = document.querySelector("#input_descricao");
            const input_imagem = document.querySelector("#input_imagem")
            
            const dados_produto = {
                
                categoria: input_categoria.value,
                nome: input_nome.value,
                preco: input_preco.value,
                descricao: input_descricao.value,
                imagem: input_imagem.value
            
            }

            try {
            
                await fetch(baseUrl + "/produtos", {
            
                    method: "POST",
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(dados_produto)
            
                });

                document.location.reload()

            } catch (error) {
            
                alert("Ocorreu um erro")
                console.log(error)
        
            }

            input_categoria.value = "";
            input_nome.value = "";
            input_preco.value = "";
            input_descricao.value = "";
            input_imagem.value = "";

            const m = document.querySelector("#exampleModal");
            const modal = bootstrap.Modal.getInstance(m);
            modal.hide();
            exibir_dados();
        
        }

        async function remover_dados(id) {
      
            const modalRemover = new bootstrap.Modal('#modalRemover');
            modalRemover.show();
            const btnRemover = document.querySelector("#remover");
            btnRemover.addEventListener("click", async () => {
  
                try {
        
                    await fetch(baseUrl + "/deletar/" + id, { method: "DELETE" });
                    modalRemover.hide();
                    exibir_dados(produtos);
    
                } catch (error) {
        
                    document.location.reload()
    
                }

            });

        }

        async function buscar_nome() {
      
            const filtro = document.querySelector("#search");
            console.log(filtro.value);
      
            try {
                
                if (filtro.value == "")
                    
                    get_dados();
                
                else {
                    
                    const response = await fetch(baseUrl + "/nome/" + filtro.value);
                    const data = await response.json();
                    exibir_dados(data);
                
                }
            
            } catch (error) {
                
                alert("Ocorreu um erro")
                console.log(error.message)
                
            }

        }

        async function buscar_categoria(filtro) {

            console.log(filtro);
      
            try {
                
                const response = await fetch(baseUrl + "/categoria/" + filtro);
                const data = await response.json();
                exibir_dados(data);
            
            } catch (error) {
                
                alert("Ocorreu um erro")
                console.log(error.message)
                
            }
        
        }

        async function editar_dados(id) {
      
            const edit_categoria = document.querySelector("#edit_categoria");
            const edit_nome = document.querySelector("#edit_nome");
            const edit_preco = document.querySelector("#edit_preco");
            const edit_descricao = document.querySelector("#edit_descricao");
            const edit_imagem = document.querySelector("#edit_imagem");
            
            try {
        
                const response = await fetch(baseUrl + "/id/" + id);
                const data = await response.json();

                edit_categoria.value = data.categoria;
                edit_nome.value = data.nome;
                edit_preco.value = data.preco;
                edit_descricao.value = data.descricao;
                edit_imagem.value = data.imagem_link;

            } catch (error) {
        
                alert("Ocorreu um erro")
                console.log(error)

            }

            const modalEditar = new bootstrap.Modal('#editModal');
            modalEditar.show();
            const editar = document.querySelector("#editar");
            editar.addEventListener("click", async () => {
        
                const dado = {
                    
                    categoria: edit_categoria.value,
                    nome: edit_nome.value,
                    preco: edit_preco.value,
                    descricao: edit_descricao.value,
                    imagem: edit_imagem.value
        
                };
        
                try {
            
                    const response = await fetch(baseUrl + "/produtos/" + id, {
                    method: "PUT",
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(dado)});
                
                    modalEditar.hide();
                    document.location.reload();
        
                } catch (error) {
            
                    alert("Ocorreu um erro")
                    console.log(error)
        
                }

            })

        }

        async function expandir_dados(id) {
            
            const card = document.querySelector("#card");

            try {
                
                const response = await fetch(baseUrl + "/id/" + id);
                const data = await response.json();
                
                card.innerHTML = `
                <div class="modal-header" style="background-image: url('${data.imagem_link}'); height: 250px; background-size:cover; background-position: 50%">
              
                    <button type="button" class="btn-close position-absolute top-0 end-0" data-bs-dismiss="modal" aria-label="Close" style = "background-color: #0d6efd; border-radius: 50%; margin:10px; opacity: inherit;"></button>
          
                </div>
          
                <div class="modal-body" style = "margin: 0 20px;">
          
                    <h3>${data.nome}</h3>
                    <p style = "margin-bottom: 10px; margin-top:17px">${data.descricao}</p>
                    <p><b style="font-weight: 600;">Categoria:</b> ${data.categoria};<br>
                    <b style="font-weight: 600;">Preço unitário:</b> ${data.preco}R$;</p>
                    
                </div>
                `
            } catch (error) {
                
                alert("Ocorreu um erro")
                console.log(error)
            
            }

            const showModal = new bootstrap.Modal('#showModal');
            showModal.show();

        }

        function limpar_campo() {
        
            document.getElementById('search').value = ''; 

        }

    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
    crossorigin="anonymous"></script>

</body>

</html>